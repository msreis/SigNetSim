{#   _layout/base.html : This is the top template 							  #}

{#   Copyright (C) 2016 Vincent Noel (vincent.noel@butantan.gov.br) 		  #}

{#   This program is free software: you can redistribute it and/or modify     #}
{#   it under the terms of the GNU Affero General Public License as published #}
{#   by the Free Software Foundation, either version 3 of the License, or     #}
{#   (at your option) any later version. 									  #}

{#   This program is distributed in the hope that it will be useful, 		  #}
{#   but WITHOUT ANY WARRANTY; without even the implied warranty of 		  #}
{#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the 			  #}
{#   GNU Affero General Public License for more details.					  #}

{#   You should have received a copy of the GNU Affero General Public License #}
{#   along with this program. If not, see <http://www.gnu.org/licenses/>. 	  #}

{% extends '_layouts/fullpage.html' %}
{% load bootstrap3 %}

{% block title %} Profile | {{ block.super }}{% endblock title %}
{% block view_content %}

<div class="container-fluid">
  <h4>Profile</h4>
  <hr/><br/>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <table class="table table-striped">
      <thead>
        <tr class="row">
          <th class="col-xs-11">Full name</th>
          <th class="col-xs-2"></th>
        </tr>
      </thead>
      <tbody>
        <tr class="row">
          <td class="col-xs-11 text-center">
            <input type="text" class="form-control input-sm invisible_inputs" placeholder="<Input full name>" id="fullname_input" name="fullname" value="{% if user.fullname != None %}{{user.fullname}}{% endif %}">
          </td>
          <td class="col-xs-1">
            <div class="pull-right collapse" id="save_fullname_input">
              <button type="submit" name="action" value="change_fullname" class="btn btn-primary btn-xs btn-success" title="Save changes to full name">{% bootstrap_icon "ok" %}</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </form>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <table class="table table-striped">
      <thead>
        <tr class="row">
          <th class="col-xs-11">Email</th>
          <th class="col-xs-2"></th>
        </tr>
      </thead>
      <tbody>
        <tr class="row">
          <td class="col-xs-11 text-center">
            <input type="text" class="form-control input-sm invisible_inputs" placeholder="<Input email>" id="email_input" name="email" value="{% if user.email != None %}{{user.email}}{% endif %}">
          </td>
          <td class="col-xs-1">
            <div class="pull-right collapse" id="save_email_input">
              <button type="submit" name="action" value="change_email" class="btn btn-primary btn-xs btn-success" title="Save changes to email">{% bootstrap_icon "ok" %}</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </form>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <table class="table table-striped">
      <thead>
        <tr class="row">
          <th class="col-xs-11">Change password</th>
          <th class="col-xs-2"></th>
        </tr>
      </thead>
      <tbody>
        <tr class="row">
          <td class="col-xs-11 text-center">
            <input type="password" class="form-control input-sm invisible_inputs" placeholder="<Input password>" id="password1_input" name="password1" value="">
          </td>
          <td class="col-xs-1">
          </td>
        </tr>
        <tr class="row">
          <td class="col-xs-11 text-center">
            <input type="password" class="form-control input-sm invisible_inputs" placeholder="<Input password again>" id="password2_input" name="password2" value="">
          </td>
          <td class="col-xs-1">
            <div class="pull-right collapse" id="save_password_input">
              <button type="submit" name="action" value="change_password" class="btn btn-primary btn-xs btn-success" title="Save changes to passord">{% bootstrap_icon "ok" %}</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </form>
</div>

<script>

var old_fullname = "{% if user.fullname != None %}{{user.fullname}}{% endif %}";
$("#fullname_input").on('focus change paste keyup', function()
{
  if (old_fullname === $("#fullname_input").val()) {
    $("#save_fullname_input").removeClass('in');
  } else {
    $("#save_fullname_input").addClass('in');
  }
});

var old_email = "{% if user.email != None %}{{user.email}}{% endif %}";
$("#email_input").on('focus change paste keyup', function()
{
  if (old_email === $("#email_input").val()) {
    $("#save_email_input").removeClass('in');
  } else {
    $("#save_email_input").addClass('in');
  }
});

$("#password1_input").on('focus change paste keyup', function()
{
  check_passwords_match();
});


$("#password2_input").on('focus change paste keyup', function()
{
  check_passwords_match();
});

function check_passwords_match()
{
  if ($("#password1_input").val() !== "" && $("#password1_input").val() === $("#password2_input").val()) {
    $("#save_password_input").addClass('in');
  } else {
    $("#save_password_input").removeClass('in');
  }
}




</script>
{% endblock view_content %}
