{% load bootstrap3 %}
{% load tags %}
{% load static from staticfiles %}

<!-- Modal -->
<div class="modal fade out" tabindex="-1" role="dialog" aria-labelledby="{% if form_subs.isEditing == True %}Edit{% else %}New{% endif %} modification" id="modal_modification">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form class="form" method="POST" action="" label="Save modification">
        {% csrf_token %}
        <input type="hidden" name="substitution_id" value="{% if form_subs.id != None %}{{form_subs.id}}{% endif %}">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="modal_modification_title">{% if form_subs.isEditing == True %}Edit{% else %}New{% endif %} modification</h4>
        </div>
        <div class="modal-body">
          <table class="table table-striped">
            <thead>
              <tr class="row">
                <th class="col-xs-12">Type</th>
              </tr>
            </thead>
            <tbody>
              <tr class="row">
                <td class="col-xs-12">
                  <input type="hidden" name="substitution_type" id="substitution_type" value="{% if form_subs.type == 1 %}1{% else %}0{% endif %}">
                  <div class="dropdown">
                    <button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown">
                      <span id="substitution_type_label">{% if form_subs.type == 0 or form_subs.type == None %}{{form_subs.types|my_lookup:0}}{% else %}{{form_subs.types|my_lookup:form_subs.type}}{% endif %}</span>
                      <span class="caret"></span>
                    </button>
                    <ul id="substitution_type_dropdown" class="dropdown-menu">
                      {% for type in form_subs.types %}
                      <li><a>{{ type }}</a></li>
                      {% endfor %}
                    </ul>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          <table class="table table-striped">
            <thead>
              <tr class="row">
                <th class="col-xs-12">Model object</th>
              </tr>
            </thead>
            <tbody>
              <tr class="row">
                <td class="col-xs-12">
                  <input type="hidden" name="substitution_model_object" id="substitution_model_object" value="{% if form.modelObject != None %}{{form_subs.modelObject}}{% endif %}">
                  <div class="dropdown">
                    <button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown">
                      <span id="substitution_model_object_label">{% if form_subs.modelObject != None %}{{list_of_objects|my_lookup:form_subs.modelObject}}{% else %}Select an object in the main model{% endif %}</span>
                      <span class="caret"></span>
                    </button>
                    <ul id="substitution_model_object_dropdown" class="dropdown-menu">
                      {% for object in list_of_objects %}
                      <li><a>{{object}}</a></li>
                      {% endfor %}
                    </ul>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          <table class="table table-striped">
            <thead>
              <tr class="row">
                <th class="col-xs-12">Submodel's object</th>
              </tr>
            </thead>
            <tbody>
              <tr class="row">
                <td class="col-xs-12">
                  <input type="hidden" name="substitution_submodel" id="substitution_submodel" value="{% if form.source != None %}{{form.source}}{% endif %}">
                  <div class="dropdown">
                    <button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown">
                      <span id="substitution_submodel_label">{% if form.submodel != None %}{{list_of_submodels|my_lookup:form.submodel}}{% else %}Select a submodel{% endif %}</span>
                      <span class="caret"></span>
                    </button>
                    <ul id="substitution_submodel_dropdown" class="dropdown-menu">
                      {% for submodel in list_of_submodels %}
                      <li><a>{{submodel.getSbmlId}}</a></li>
                      {% endfor %}
                    </ul>
                  </div>
                </td>
              </tr>
              <tr class="row">
                <td class="col-xs-12 text-center">
                  <div class="collapse col-xs-12" id="substitution_list_of_objects_loading">
                      <img src="{% static 'images/wait_blue.svg' %}" class="loading-anim">
                  </div>
                  <div class="collapse col-xs-12" id="substitution_list_of_objects_loading_failed">
                    <span class="glyphicon glyphicon-remove" style="color:#d9534f; font-size: 1.5em"></span>
                  </div>
                  <div class="collapse in" id="substitution_list_of_objects_loaded">
                    <input type="hidden" name="substitution_submodel_object" id="substitution_submodel_object" value="{% if form.source != None %}{{form.source}}{% endif %}">
                    <div class="dropdown">
                      <button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown">
                        <span id="substitution_submodel_object_label">Select an object in the submodel</span>
                        <span class="caret"></span>
                      </button>
                      <ul id="substitution_submodel_object_dropdown" class="dropdown-menu">
                        {% for object in form_subs.listOfObjects %}
                        <li><a>{{ object }}</a></li>
                        {% endfor %}
                      </ul>
                    </div>
                    <script type="text/javascript">
                      $("#substitution_submodel_object_dropdown li").on("click", function(){
                        $("#substitution_submodel_object_label").html($(this).text());
                        $("#substitution_submodel_object").val($(this).index());
                      });
                    </script>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          {% include 'commons/error_modal.html' %}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="submit" name="action" value="save_substitution" class="btn btn-primary">Save changes</button>
        </div>
      </form>
    </div>
  </div>
</div>



